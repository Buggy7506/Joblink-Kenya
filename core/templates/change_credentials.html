{% extends "base.html" %}

{% block title %}Change Personal Info{% endblock %}

{% block content %}
<div class="update-account-wrapper">
  <div class="form-container">
    <h2>Personal Info</h2>

    <!-- Profile Picture Preview -->
    <div class="profile-pic-wrapper">
      <img id="profile-pic-preview"
           src="{% if user.profile_pic %}{{ user.profile_pic.url }}{% else %}https://res.cloudinary.com/dc6z1giw2/image/upload/v1754578015/jo2wvg1a0wgiava5be20.png{% endif %}"
           alt="Profile Picture">
      <input type="file" id="profile-pic-input" name="profile_pic" style="display:none;">
      <span class="profile-pic-hover">üì∏ Click to change</span>
    </div>

    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      {{ form.non_field_errors }}

      {{ form.username.label_tag }} {{ form.username }}
      {{ form.first_name.label_tag }} {{ form.first_name }}
      {{ form.last_name.label_tag }} {{ form.last_name }}
      {{ form.email.label_tag }} {{ form.email }}
      {{ form.phone.label_tag }} {{ form.phone }}
      {{ form.location.label_tag }} {{ form.location }}

      {% if user.role == 'applicant' %}
        {{ form.skills.label_tag }} {{ form.skills }}
        <label for="{{ form.upload_cv.id_for_label }}">Upload CV</label>
        {{ form.upload_cv }}
      {% endif %}

      <input type="submit" value="Save Changes">
    </form>

    {% if user.is_superuser or user.role == 'admin' %}
      <a href="{% url 'admin_dashboard' %}" class="button">‚Üê Dashboard</a>
    {% elif user.role == 'employer' %}
      <a href="{% url 'dashboard' %}" class="button">‚Üê Dashboard</a>
    {% else %}
      <a href="{% url 'dashboard' %}" class="button">‚Üê Dashboard</a>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.update-account-wrapper {
  background: var(--page-bg);
  color: var(--text);
  font-family: 'Segoe UI', sans-serif;
  padding: 50px 20px;
  display:flex;
  justify-content:center;
}

.update-account-wrapper .form-container {
  background: var(--card-bg);
  backdrop-filter: blur(12px);
  padding:30px;
  border-radius:20px;
  width:100%;
  max-width:500px;
  border:2px solid var(--accent);
  box-shadow:0 0 25px var(--glow-soft),0 0 40px var(--glow-strong);
}

.update-account-wrapper .form-container h2 {
  text-align:center;
  margin-bottom:25px;
  color: var(--accent);
  text-shadow:0 0 12px var(--accent);
}

/* Profile Picture Wrapper */
.profile-pic-wrapper {
  display:flex;
  justify-content:center;
  position:relative;
  margin-bottom:30px;
  perspective: 800px;
}

#profile-pic-preview {
  width:140px;
  height:140px;
  object-fit:cover;
  border-radius:50%;
  border:4px solid transparent;
  padding:5px;
  background: linear-gradient(45deg, #8e2de2, #4a00e0);
  box-shadow:0 0 15px #8e2de2,0 0 25px #4a00e0,0 0 50px rgba(142,45,226,0.4);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  cursor:pointer;
}

.profile-pic-hover {
  position:absolute;
  bottom:-10px;
  color:#fff;
  font-weight:bold;
  font-size:14px;
  text-shadow:0 0 8px #8e2de2;
  pointer-events:none;
}

/* Form Inputs */
.update-account-wrapper input[type="text"],
.update-account-wrapper input[type="email"],
.update-account-wrapper input[type="password"],
.update-account-wrapper input[type="tel"],
.update-account-wrapper textarea,
.update-account-wrapper input[type="file"] {
  width:100%;
  padding:12px;
  margin-bottom:20px;
  border-radius:10px;
  background:var(--input-bg);
  color:var(--text);
  border:1px solid var(--border);
  outline:none;
  box-shadow:inset 0 0 8px var(--glow-soft);
}

/* Submit button */
.update-account-wrapper input[type="submit"] {
  display:inline-block;
  text-align:center;
  background:linear-gradient(90deg,var(--accent),var(--accent-alt));
  border:none;
  width:100%;
  padding:12px;
  border-radius:10px;
  color:var(--btn-text);
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 0 15px var(--glow-soft),0 0 25px var(--glow-strong);
  transition:0.3s;
}

.update-account-wrapper input[type="submit"]:hover {
  transform:translateY(-2px);
  box-shadow:0 0 25px var(--glow-strong),0 0 45px var(--glow-strong);
}

/* Dashboard button */
.update-account-wrapper a.button {
  display:inline-block;
  text-align:center;
  background:linear-gradient(90deg,var(--accent),var(--accent-alt));
  color:var(--btn-text);
  padding:12px 20px;
  border-radius:8px;
  font-weight:bold;
  text-decoration:none;
  margin-top:15px;
  box-shadow:0 0 15px var(--glow-soft),0 0 25px var(--glow-strong);
  transition:0.3s;
}

.update-account-wrapper a.button:hover {
  transform:translateY(-2px);
  box-shadow:0 0 25px var(--glow-strong),0 0 45px var(--glow-strong);
}

/* Responsive */
@media(max-width:600px){
  .update-account-wrapper{padding:30px 10px;}
  .update-account-wrapper .form-container{padding:20px;border-radius:12px;}
  .update-account-wrapper .form-container h2{font-size:20px;}
  .update-account-wrapper label{font-size:14px;}
  .update-account-wrapper input,.update-account-wrapper textarea{font-size:14px;padding:8px;}
  .update-account-wrapper input[type="submit"],.update-account-wrapper a.button{font-size:15px;padding:10px;}
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){

  // =========================
  // Location autocomplete
  // =========================
  const locationInput = document.querySelector('input[name="location"]');
  if(locationInput && window.google){
    const autocomplete = new google.maps.places.Autocomplete(locationInput, { types:["geocode"] });
    autocomplete.addListener('place_changed', function(){
      const place = autocomplete.getPlace();
      if(place.formatted_address){ locationInput.value = place.formatted_address; }
    });
  }

  // =========================
  // Profile pic preview & dynamic glow
  // =========================
  const pic = document.getElementById('profile-pic-preview');
  const input = document.getElementById('profile-pic-input');

  if(pic && input){
    pic.addEventListener('click', ()=> input.click());
    input.addEventListener('change', function(){
      if(this.files && this.files[0]){
        const reader = new FileReader();
        reader.onload = e => pic.src = e.target.result;
        reader.readAsDataURL(this.files[0]);
      }
    });

    // Dynamic glow effect based on mouse movement
    pic.addEventListener('mousemove', function(e){
      const rect = pic.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const dx = (x - centerX)/centerX;
      const dy = (y - centerY)/centerY;
      const r = dx * 15;
      const t = dy * 15;
      pic.style.transform = `rotateX(${-t}deg) rotateY(${r}deg) scale(1.08)`;
      pic.style.boxShadow = `${dx*30}px ${dy*30}px 35px #8e2de2, ${-dx*30}px ${-dy*30}px 50px #4a00e0, 0 0 70px rgba(142,45,226,0.6)`;
    });

    pic.addEventListener('mouseleave', function(){
      pic.style.transform = `rotateX(0deg) rotateY(0deg) scale(1)`;
      pic.style.boxShadow = `0 0 15px #8e2de2, 0 0 25px #4a00e0, 0 0 50px rgba(142,45,226,0.4)`;
    });
  }

});
</script>
{% endblock %}
