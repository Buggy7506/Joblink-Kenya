{% extends "base.html" %}

{% block title %}Applied Jobs{% endblock %}

{% block content %}

<style>
/* Container */
.applications-container {
  background: var(--bg-card, rgba(15, 15, 30, 0.95));
  border-radius: 16px;
  padding: 30px;
  margin: 40px auto;
  max-width: 950px;
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.25);
  animation: fadeIn 1s ease-in-out;
  overflow-x: auto;
  transition: background 0.4s, color 0.4s;
}

/* Heading */
.glow-heading {
  font-size: 2rem;
  text-align: center;
  margin-bottom: 25px;
  color: var(--glow-main);
  text-shadow: 0 0 8px var(--glow-main), 0 0 16px var(--glow-accent);
}

/* Table */
.table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 12px;
}

.table thead th {
  background: linear-gradient(90deg, var(--glow-main), var(--text-accent));
  color: var(--text-main);
  padding: 14px 18px;
  font-size: 1rem;
  border-radius: 8px;
}

.table tbody tr {
  background: rgba(20, 20, 40, 0.9);
  border-radius: 12px;
  box-shadow: 0 0 10px var(--glow-main, rgba(0,255,200,0.12));
  transition: transform 0.2s ease, box-shadow 0.3s ease, opacity 0.4s;
}

.table tbody tr:hover {
  transform: translateY(-3px);
  box-shadow: 0 0 18px var(--glow-main, rgba(0,255,200,0.3));
}

.table td {
  padding: 14px 18px;
  font-size: 0.95rem;
  color: var(--text-main);
}

/* Links */
.table a {
  color: var(--text-accent);
  text-decoration: none;
  font-weight: bold;
  transition: 0.3s;
}

.table a:hover {
  color: var(--glow-main);
  text-shadow: 0 0 6px var(--glow-accent);
}

/* Status Labels */
.text-success { color: #22c55e; font-weight: bold; text-shadow: 0 0 6px #22c55e; }
.text-danger { color: #ef4444; font-weight: bold; text-shadow: 0 0 6px #ef4444; }
.text-warning { color: #facc15; font-weight: bold; text-shadow: 0 0 6px #facc15; }

/* Chat Button */
.chat-btn {
  display: inline-block;
  padding: 10px 18px;
  border-radius: 12px;
  background: var(--text-accent);
  color: var(--text-main);
  font-weight: bold;
  text-align: center;
  box-shadow: 0 0 15px var(--glow-main), 0 0 30px var(--glow-accent);
  transition: all 0.3s ease;
  text-decoration: none;
}
.chat-btn:hover {
  box-shadow: 0 0 25px var(--glow-main), 0 0 50px var(--glow-accent);
  transform: translateY(-2px);
}

/* Delete Button */
.delete-btn {
  display: inline-block;
  padding: 10px 18px;
  border-radius: 12px;
  background: #ff3b5c;
  color: white;
  font-weight: bold;
  box-shadow: 0 0 15px #ff3b5c, 0 0 30px #ff3b5c;
  cursor: pointer;
  transition: 0.3s ease;
}
.delete-btn:hover {
  background: #e60039;
  box-shadow: 0 0 25px #ff3b5c, 0 0 50px #ff3b5c;
  transform: translateY(-2px);
}

/* Empty State */
.empty-msg {
  text-align: center;
  font-size: 1.2rem;
  color: var(--text-muted);
  padding: 20px;
}

/* Fade Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

<!-- SweetAlert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="applications-container" data-aos="zoom-in">
  <h2 class="glow-heading">üíº My Job Applications</h2>

  {% if applications %}
    <table class="table">
      <thead>
        <tr>
          <th>Job Title</th>
          <th>Employer</th>
          <th>Status</th>
          <th>Applied On</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for app in applications %}
        <tr id="row-{{ app.id }}">
          <td><a href="{% url 'job_detail' app.job.id %}">{{ app.job.title }}</a></td>
          <td>{{ app.job.employer.username }}</td>
          <td>
            {% if app.status == "accepted" %}
              <span class="text-success">‚úÖ Accepted</span>
            {% elif app.status == "rejected" %}
              <span class="text-danger">‚ùå Rejected</span>
            {% else %}
              <span class="text-warning">‚è≥ Pending</span>
            {% endif %}
          </td>
          <td>{{ app.applied_on|date:"M d, Y H:i" }}</td>
          <td style="display:flex; gap:8px;">
            <a href="{% url 'job_chat' app.id %}" class="chat-btn">üí¨ Chat</a>
            <button class="delete-btn" onclick="deleteApplication({{ app.id }})">üóë Delete</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="empty-msg">üöÄ You haven‚Äôt applied for any jobs yet.</p>
  {% endif %}
</div>

<script>
function deleteApplication(appId) {
  const csrfToken = '{{ csrf_token }}';

  Swal.fire({
    title: "Delete Application?",
    text: "This will move the application to the Recycle Bin. You can restore it within 7 days.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#ff3b5c",
    cancelButtonColor: "#555",
    confirmButtonText: "Yes, delete it!"
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`/applications/delete/${appId}/`, {
        method: "POST",
        headers: {
          "X-CSRFToken": csrfToken,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({})
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          const row = document.getElementById(`row-${appId}`);
          row.style.opacity = "0";
          setTimeout(() => row.remove(), 400);
          Swal.fire("Deleted!", "Application moved to Recycle Bin.", "success");
        } else {
          Swal.fire("Error!", data.message || "Could not delete application.", "error");
        }
      })
      .catch(() => {
        Swal.fire("Error!", "Network or server error.", "error");
      });
    }
  });
}
</script>

{% endblock %}
