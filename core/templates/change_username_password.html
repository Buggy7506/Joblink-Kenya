{% extends 'base.html' %}
{% block title %}Change Username & Password| JobLink Kenya{% endblock %}
{% block content %}
<style>
/* --- Form wrapper --- */
.form-wrapper {
  min-height: 100vh;
  padding: 60px 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  background: var(--page-bg);
  color: var(--text);
  font-family: 'Segoe UI', sans-serif;
}

.form-container {
  max-width: 500px;
  width: 100%;
  padding: 40px;
  background: var(--card-bg);
  border-radius: 16px;
  box-shadow: 0 0 30px var(--glow-soft);
  border: 1px solid var(--accent);
}

.form-container h2 {
  text-align: center;
  margin-bottom: 30px;
  color: var(--accent);
  text-shadow: 0 0 5px var(--accent), 0 0 10px var(--accent);
}

.input-group {
  margin-bottom: 25px;
  position: relative;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  color: var(--text);
}

/* Inputs with glow styling */
.input-group input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: var(--input-bg);
  color: var(--text);
  font-size: 16px;
  box-shadow: inset 0 0 6px var(--glow-soft);
  transition: 0.3s ease;
}

.input-group input:focus {
  outline: none;
  box-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent);
  background: var(--input-bg-focus);
  border-color: var(--accent);
}

/* Password row overrides */
.input-group .password-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.show-btn {
  padding: 8px 10px;
  border-radius: 4px;
  border: 1px solid var(--accent);
  background: var(--input-bg);
  color: var(--accent);
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
  transition: 0.3s ease;
}

.show-btn:hover {
  background: var(--accent);
  color: var(--btn-text);
  box-shadow: 0 4px 12px var(--glow-soft);
}

.glow-btn {
  width: 100%;
  padding: 14px;
  background: var(--accent);
  color: var(--btn-text);
  font-weight: bold;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.4s ease;
  box-shadow: 0 0 10px var(--glow-soft), 0 0 40px var(--glow-strong);
}

.glow-btn:hover {
  background: var(--accent-alt);
  box-shadow: 0 0 20px var(--glow-strong), 0 0 60px var(--glow-strong);
}

.errorlist {
  color: var(--danger);
  font-size: 14px;
  margin-top: 6px;
}

h4 {
  display: block;
  text-align: center;
  margin-top: 15px;
  color: var(--text);
  text-decoration: none;
}

h4 a:hover {
  text-decoration: underline;
  color: var(--link);
}

/* Messages popup */
#messages-popup {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%) translateY(-100%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  animation: slideDown 0.5s forwards;
}

.message {
  background-color: var(--accent);
  color: var(--btn-text);
  padding: 12px 20px;
  border-radius: 25px;
  font-weight: bold;
  box-shadow: 0 0 10px var(--glow-soft), 0 0 20px var(--glow-strong);
  opacity: 0.95;
}

.message.error {
  background-color: var(--danger);
  color: var(--btn-text);
  box-shadow: 0 0 10px var(--danger), 0 0 20px var(--danger);
}

@keyframes slideDown {
  to { transform: translateX(-50%) translateY(20px); }
}

@keyframes fadeOut {
  to { opacity: 0; transform: translateX(-50%) translateY(-50px); }
}
</style>


<div class="form-wrapper">
  <div class="form-container">
    <h2>Reset Username & Password üîê</h2>

    {% if messages %}
      <div id="messages-popup">
        {% for message in messages %}
          <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST" autocomplete="off">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="input-group">
        {{ form.username.label_tag }}
        {{ form.username }}
        {{ form.username.errors }}
      </div>

      <div class="input-group">
        {{ form.old_password.label_tag }}
        <div class="password-row">
          {{ form.old_password }}
          <button type="button" class="show-btn" data-target="id_old_password">Show</button>
        </div>
        {{ form.old_password.errors }}
      </div>

      <div class="input-group">
        {{ form.new_password1.label_tag }}
        <div class="password-row">
          {{ form.new_password1 }}
          <button type="button" class="show-btn" data-target="id_new_password1">Show</button>
        </div>
        {{ form.new_password1.errors }}
      </div>

      <div class="input-group">
        {{ form.new_password2.label_tag }}
        <div class="password-row">
          {{ form.new_password2 }}
          <button type="button" class="show-btn" data-target="id_new_password2">Show</button>
        </div>
        {{ form.new_password2.errors }}
      </div>

      <button type="submit" class="glow-btn">üíæ Save Changes</button>
    </form>

    <h4>
      {% if user.is_superuser or user.role == 'admin' %}
        <a href="{% url 'admin_profile' %}">‚Üê Back to Profile</a>
      {% else %}
        {% if user.profile.is_employer %}
          <a href="{% url 'employer_profile' %}">‚Üê Back to Profile</a>
        {% else %}
          <a href="{% url 'profile' %}">‚Üê Go to Profile</a>
        {% endif %}
      {% endif %}
    </h4>
  </div>
</div>

<script>
document.querySelectorAll('.show-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const target = document.getElementById(btn.dataset.target);
    if(target.type === 'password'){
      target.type = 'text';
      btn.textContent = 'Hide';
    } else {
      target.type = 'password';
      btn.textContent = 'Show';
    }
  });
});

// Clear password fields and prevent autofill
document.addEventListener('DOMContentLoaded', () => {
  ['id_old_password','id_new_password1','id_new_password2'].forEach(id => {
    const field = document.getElementById(id);
    if(field){
      field.value = '';
      field.autocomplete = 'new-password';
    }
  });

  // Auto-hide messages
  const popup = document.getElementById('messages-popup');
  if(popup){
    setTimeout(() => { popup.style.animation='fadeOut 0.5s forwards'; }, 3000);
    setTimeout(() => { popup.remove(); }, 3500);
  }
});
</script>
{% endblock %}
