{% extends 'base.html' %}
{% block content %}
<style>
  .form-wrapper {
    min-height: 100vh;
    padding: 60px 0;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    background: #0f0f0f; /* Form-specific background */
    color: #f0f0f0;
    font-family: 'Segoe UI', sans-serif;
  }

  .form-container {
    max-width: 500px;
    width: 100%;
    padding: 40px;
    background: #1a1a1a;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0,255,150,0.3);
  }

  .form-container h2 {
    text-align: center;
    margin-bottom: 30px;
    color: #00ffcc;
    text-shadow: 0 0 5px #00ffcc, 0 0 10px #00ffcc;
  }

  .form-container .input-group {
    margin-bottom: 25px;
    position: relative;
  }

  .form-container .input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #ffffff;
  }

  .form-container .input-group input {
    width: 100%;
    padding: 10px 50px 10px 12px; 
    border-radius: 4px;
    border: 1px solid #444;
    background: #121212;
    color: #00ffcc;
    font-size: 16px;
    box-shadow: inset 0 0 6px #00ffcc;
    transition: 0.3s ease;
  }

  .form-container .input-group input:focus {
    outline: none;
    box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
    background: #1f1f1f;
    border-color: #00ffcc;
  }

  .form-container .toggle-password {
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    padding: 3px 8px;
    border-radius: 4px;
    border: 1px solid #00ffcc;
    background: #121212;
    color: #00ffcc;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: 0.3s ease;
  }

  .form-container .toggle-password:hover {
    background: #00ffcc;
    color: #000;
    box-shadow: 0 4px 12px rgba(0,255,204,0.4);
  }

  .form-container .glow-btn {
    width: 100%;
    padding: 14px;
    background: #00ffcc;
    color: #000;
    font-weight: bold;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.4s ease;
    box-shadow: 0 0 10px #00ffcc, 0 0 40px #00ffcc;
  }

  .form-container .glow-btn:hover {
    background: #0ff;
    box-shadow: 0 0 20px #00ffee, 0 0 60px #00ffee;
  }

  .form-container .errorlist {
    color: #ff4f4f;
    font-size: 14px;
    margin-top: 6px;
  }

  .form-container h4 {
    display: block;
    text-align: center;
    margin-top: 15px;
    color: #f1faee;
    text-decoration: none;
  }

  .form-container h4 a:hover {
    text-decoration: underline;
  }

  .form-wrapper #messages-popup {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%) translateY(-100%);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    animation: slideDown 0.5s forwards;
  }

  .form-wrapper .message {
    background-color: #00ffcc;
    color: #000;
    padding: 12px 20px;
    border-radius: 25px;
    font-weight: bold;
    box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
    opacity: 0.95;
  }

  .form-wrapper .message.error {
    background-color: #ff4b5c;
    color: #fff;
    box-shadow: 0 0 10px #ff4b5c, 0 0 20px #ff4b5c;
  }

  @keyframes slideDown {
    to { transform: translateX(-50%) translateY(20px); }
  }

  @keyframes fadeOut {
    to { opacity: 0; transform: translateX(-50%) translateY(-50px); }
  }
</style>

<div class="form-wrapper">
  <div class="form-container">
    <h2>Reset Username & Password üîê</h2>

    {% if messages %}
      <div id="messages-popup">
        {% for message in messages %}
          <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST" autocomplete="off">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="input-group">
        {{ form.username.label_tag }}
        {{ form.username }}
        {{ form.username.errors }}
      </div>

      <div class="input-group">
        {{ form.old_password.label_tag }}
        {{ form.old_password }}
        {{ form.old_password.errors }}
        <button type="button" class="toggle-password" onclick="FormScripts.togglePassword('id_old_password')">Show</button>
      </div>

      <div class="input-group">
        {{ form.new_password1.label_tag }}
        {{ form.new_password1 }}
        {{ form.new_password1.errors }}
        <button type="button" class="toggle-password" onclick="FormScripts.togglePassword('id_new_password1')">Show</button>
      </div>

      <div class="input-group">
        {{ form.new_password2.label_tag }}
        {{ form.new_password2 }}
        {{ form.new_password2.errors }}
        <button type="button" class="toggle-password" onclick="FormScripts.togglePassword('id_new_password2')">Show</button>
      </div>

      <button type="submit" class="glow-btn">üíæ Save Changes</button>
    </form>

    <h4>
      {% if user.is_superuser or user.role == 'admin' %}
        <a href="{% url 'admin_profile' %}">‚Üê Back to Profile</a>
      {% else %}
        {% if user.profile.is_employer %}
          <a href="{% url 'employer_profile' %}">‚Üê Back to Profile</a>
        {% else %}
          <a href="{% url 'profile' %}">‚Üê Back to Profile</a>
        {% endif %}
      {% endif %}
    </h4>
  </div>
</div>

<script>
const FormScripts = (() => {
  function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const btn = field.nextElementSibling;
    if (field.type === "password") {
      field.type = "text";
      btn.innerText = "Hide";
    } else {
      field.type = "password";
      btn.innerText = "Show";
    }
  }

  function clearPasswords() {
    ['id_old_password','id_new_password1','id_new_password2'].forEach(id => {
      const field = document.getElementById(id);
      if(field) {
        field.value = '';
        field.autocomplete = 'new-password';
      }
    });
  }

  function autoHideMessages() {
    const popup = document.getElementById('messages-popup');
    if (popup) popup.style.animation = 'fadeOut 0.5s forwards';
    setTimeout(() => {
      if (popup) popup.remove();
    }, 500);
  }

  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(clearPasswords, 50);
    setTimeout(autoHideMessages, 3000);
  });

  return { togglePassword };
})();
</script>
{% endblock %}
