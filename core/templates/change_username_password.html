{% extends 'base.html' %}
{% block content %}
<style>
.form-wrapper {
  min-height: 100vh;
  padding: 60px 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  background: #0f0f0f;
  color: #f0f0f0;
  font-family: 'Segoe UI', sans-serif;
}

.form-container {
  max-width: 500px;
  width: 100%;
  padding: 40px;
  background: #1a1a1a;
  border-radius: 16px;
  box-shadow: 0 0 30px rgba(0,255,150,0.3);
}

.form-container h2 {
  text-align: center;
  margin-bottom: 30px;
  color: #00ffcc;
  text-shadow: 0 0 5px #00ffcc, 0 0 10px #00ffcc;
}

.input-group {
  margin-bottom: 25px;
  position: relative;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  color: #fff;
}

/* All inputs now have glow styling */
.input-group input {
  width: 100%;
  padding: 10px 12px;
  border-radius: 4px;
  border: 1px solid #444;
  background: #121212;
  color: #00ffcc;
  font-size: 16px;
  box-shadow: inset 0 0 6px #00ffcc;
  transition: 0.3s ease;
}

.input-group input:focus {
  outline: none;
  box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
  background: #1f1f1f;
  border-color: #00ffcc;
}

/* Password row overrides to keep Show button layout */
.input-group .password-row {
  display: flex;
  gap: 8px;
  align-items: center;
}

.show-btn {
  padding: 8px 10px;
  border-radius: 4px;
  border: 1px solid #00ffcc;
  background: #121212;
  color: #00ffcc;
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
  transition: 0.3s ease;
}

.show-btn:hover {
  background: #00ffcc;
  color: #000;
  box-shadow: 0 4px 12px rgba(0,255,204,0.4);
}

.glow-btn {
  width: 100%;
  padding: 14px;
  background: #00ffcc;
  color: #000;
  font-weight: bold;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.4s ease;
  box-shadow: 0 0 10px #00ffcc, 0 0 40px #00ffcc;
}

.glow-btn:hover {
  background: #0ff;
  box-shadow: 0 0 20px #00ffee, 0 0 60px #00ffee;
}

.errorlist {
  color: #ff4f4f;
  font-size: 14px;
  margin-top: 6px;
}

h4 {
  display: block;
  text-align: center;
  margin-top: 15px;
  color: #f1faee;
  text-decoration: none;
}

h4 a:hover {
  text-decoration: underline;
}

#messages-popup {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%) translateY(-100%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  animation: slideDown 0.5s forwards;
}

.message {
  background-color: #00ffcc;
  color: #000;
  padding: 12px 20px;
  border-radius: 25px;
  font-weight: bold;
  box-shadow: 0 0 10px #00ffcc, 0 0 20px #00ffcc;
  opacity: 0.95;
}

.message.error {
  background-color: #ff4b5c;
  color: #fff;
  box-shadow: 0 0 10px #ff4b5c, 0 0 20px #ff4b5c;
}

@keyframes slideDown {
  to { transform: translateX(-50%) translateY(20px); }
}

@keyframes fadeOut {
  to { opacity: 0; transform: translateX(-50%) translateY(-50px); }
}
</style>

<div class="form-wrapper">
  <div class="form-container">
    <h2>Reset Username & Password üîê</h2>

    {% if messages %}
      <div id="messages-popup">
        {% for message in messages %}
          <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="POST" autocomplete="off">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="input-group">
        {{ form.username.label_tag }}
        {{ form.username }}
        {{ form.username.errors }}
      </div>

      <div class="input-group">
        {{ form.old_password.label_tag }}
        <div class="password-row">
          {{ form.old_password }}
          <button type="button" class="show-btn" data-target="id_old_password">Show</button>
        </div>
        {{ form.old_password.errors }}
      </div>

      <div class="input-group">
        {{ form.new_password1.label_tag }}
        <div class="password-row">
          {{ form.new_password1 }}
          <button type="button" class="show-btn" data-target="id_new_password1">Show</button>
        </div>
        {{ form.new_password1.errors }}
      </div>

      <div class="input-group">
        {{ form.new_password2.label_tag }}
        <div class="password-row">
          {{ form.new_password2 }}
          <button type="button" class="show-btn" data-target="id_new_password2">Show</button>
        </div>
        {{ form.new_password2.errors }}
      </div>

      <button type="submit" class="glow-btn">üíæ Save Changes</button>
    </form>

    <h4>
      {% if user.is_superuser or user.role == 'admin' %}
        <a href="{% url 'admin_profile' %}">‚Üê Back to Profile</a>
      {% else %}
        {% if user.profile.is_employer %}
          <a href="{% url 'employer_profile' %}">‚Üê Back to Profile</a>
        {% else %}
          <a href="{% url 'profile' %}">‚Üê Go to Profile</a>
        {% endif %}
      {% endif %}
    </h4>
  </div>
</div>

<script>
document.querySelectorAll('.show-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const target = document.getElementById(btn.dataset.target);
    if(target.type === 'password'){
      target.type = 'text';
      btn.textContent = 'Hide';
    } else {
      target.type = 'password';
      btn.textContent = 'Show';
    }
  });
});

// Clear password fields and prevent autofill
document.addEventListener('DOMContentLoaded', () => {
  ['id_old_password','id_new_password1','id_new_password2'].forEach(id => {
    const field = document.getElementById(id);
    if(field){
      field.value = '';
      field.autocomplete = 'new-password';
    }
  });

  // Auto-hide messages
  const popup = document.getElementById('messages-popup');
  if(popup){
    setTimeout(() => { popup.style.animation='fadeOut 0.5s forwards'; }, 3000);
    setTimeout(() => { popup.remove(); }, 3500);
  }
});
</script>
{% endblock %}
